{% extends "layout.html" %}
	{% block content %}
	<div class="container pt-3">
		<link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
		<!-- <script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script> -->
		<div>
			<h1 style="text-align: center;" >Select clients to alert</h1>
			<hr>
			
			<div id="table"></div>
		</div>

		<script type="module">


			// import { html, render } from 'https://unpkg.com/htm/preact/standalone.module.js';
			import { Grid, h, html } from "https://unpkg.com/gridjs?module";

			$(document).ready(function () {
				let selectedClients = []

				function onSelectorSelect(clientID) {
					if (selectedClients.includes(clientID)) {
						// Client ID already selected, remove it from the list
						selectedClients = selectedClients.filter(id => id !== clientID);
					} else {
						// Add the client ID to the list of selected clients
						selectedClients.push(clientID);
					}
					// Updating the value of the hidden field
					const selectedClientsField = $('#selectedClients');
					selectedClientsField.val(selectedClients.join(','));
					console.log(selectedClients);
				}
				
				

			new Grid({

				columns: [
					{ id: 'name', name: 'Name' },
					{ id: 'slotDay', name: '{{ alertDayOfWeek }}', sort: true },
					{ id: 'clientid', name: 'id', hidden: true},
					{ id: 'selected', name: 'Alert?',
									formatter: (cell, row, rowIndex) => {
									let clientID = (rowIndex + 1).toString();

										return h('div', {}, [
											h('div', {
												className: 'select-group',
											}, [
												h('input', {
													className: 'form-check',
													type: 'checkbox',
													onClick: () => onSelectorSelect(row.cells[2].data),
													// checked: true,

												}),

											]),
										]);
									},
								},
							],
			data: [
				{% for human in availhumans %}
				{
					name: '{{ human.first_name }} {{human.first_name}}',
					slotDay: "âš«",
					clientid: '{{ human.id }}',


				},
				{% endfor %}
			],
			search: {
				selector: (cell, rowIndex, cellIndex) => [0, 1, 4].includes(cellIndex) ? cell : null,
			},
			sort: true,
			pagination: true,
			language: {
				noRecordsFound: "None of your client's preferences matches your new slot availability date",
			}
			
			}).render(document.getElementById('table'));
		});

		// // Checks the 
		// 		$('.form-check').each(function () {
		// 			const checkbox = $(this);
		// 			const clientID = checkbox.data('client-id');
		// 			if (!checkbox.prop('checked')) {
		// 				selectedClients.push(clientID);
		// 			}
		// 		});
		// 		// Update value after check
		// 		const selectedClientsField = $('#selectedClients');
		// 		selectedClientsField.val(selectedClients.join(','));
		// 		console.log(selectedClients)
			

		</script>

		<form method="POST" action="/waitalert/{{ alertid }}/alertees">
			<!-- # Hidden tag method adds a CSRF token -->
			{{ form.hidden_tag() }}

			<!-- Hidden field for selected client IDs -->
			{{ form.selectedClients() }}

			<!-- {{ form.submit }} -->
			<div class="row pt-5 justify-content-end pr-3">
				<a href="{{ url_for('alerts.newWaitAlert', tempalertid=alertid, owneremail=useremail )}}" class="btn cancel-btn mr-2">Back</a>
				<button type="submit" class="btn btn-submit">Send Alert</button>
			</div>

		</form>


	</div>
	


	
{% endblock content %}

